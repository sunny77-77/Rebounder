<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rebounder é€†è½‰è‚¡ç¥¨ - AI è¨ºæ–·ç³»çµ±</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Pinned to stable 18.2.0) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- PropTypes (Required for Recharts UMD build) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts (Pinned to stable 2.12.3) -->
    <script src="https://unpkg.com/recharts@2.12.3/umd/Recharts.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        /* è‡ªå®šç¾©æ²è»¸æ¨£å¼ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Tooltip å‹•ç•« */
        .tooltip-content {
            transition: opacity 0.2s, transform 0.2s;
            transform: translateY(4px);
        }
        .group\/info:hover .tooltip-content,
        .group\/marker:hover .tooltip-content {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine, AreaChart, Area 
        } = Recharts;

        // --- Icons (Inline SVGs) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const ShieldCheck = (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const ArrowLeft = (props) => <IconBase {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconBase>;
        const Activity = (props) => <IconBase {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconBase>;
        const Microscope = (props) => <IconBase {...props}><path d="M6 18h8"/><path d="M3 22h18"/><path d="M14 22a7 7 0 1 0 0-14h-1"/><path d="M9 14h2"/><path d="M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z"/><path d="M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3"/></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></IconBase>;
        const XCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></IconBase>;
        const Gauge = (props) => <IconBase {...props}><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></IconBase>;
        const Calendar = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconBase>;
        const Target = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></IconBase>;
        const Lightbulb = (props) => <IconBase {...props}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2.4 1.5-3.8 0-3.2-2.6-5.8-5.8-5.8-3.2 0-5.8 2.6-5.8 5.8 0 1.4.5 2.8 1.5 3.8.8.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></IconBase>;
        const HelpCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></IconBase>;
        const History = (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></IconBase>;
        const ExternalLink = (props) => <IconBase {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></IconBase>;

        // --- Data ---

        const MARKET_DROP_TODAY = -1.5; 
        const MARKET_INDEX = 30288;       

        const INITIAL_STOCKS = [
          {
            id: '2330',
            name: 'å°ç©é›»',
            price: 1680,            
            low: 1675,
            change: -2.0,          
            volume: 31237,         
            avgVolume5dVal: 480,   
            priceAvg20d: 1700,     
            priceAvg60d: 1720,     
            bollingerLower: 1650,  
            marketCapVal: 435700,
            rsi6: 35,              
            netBuy5d: -5000,       
            institutionalHoldings: 78,
            eps4Q: 61.2,           
            roe: 28.5,
            isExDividend: false,
            sector: 'åŠå°é«”',
            panicLevel: 35,
            fairValue: 1900,       
            resistancePrice: 1750, 
            history: [
              { date: '01/06', price: 1705 }, { date: '01/07', price: 1695 }, { date: '01/08', price: 1700 },
              { date: '01/09', price: 1680 }, { date: '01/10', price: 1685 }, { date: '01/12', price: 1680 },
            ],
            aiDiagnosis: {
              probability: 65,
              natureTag: 'EXTERNAL', 
              conclusion: 'å—åœ‹éš›å±€å‹¢å½±éŸ¿å°è‡´å¤–è³‡é¿éšªè³£å‡ºï¼Œé€™ä¸¦éå…¬å¸ç‡Ÿé‹å‡ºå•é¡Œï¼Œè€Œæ˜¯å¤–éƒ¨å› ç´ é€ æˆçš„éç†æ€§ä¸‹è·Œã€‚',
              reasons: [
                'å¤–è³‡é¿éšªè³£å£“ï¼šå› æ‡‰ä¸­æ±åœ°ç·£å±€å‹¢å‡æº«ï¼Œå¤–è³‡å–®æ—¥ææ¬¾ 1.5 è¬å¼µã€‚',
                'è²»åŠé€£å‹•ï¼šç¾è‚¡ SOX æŒ‡æ•¸é‡æŒ« 4.2%ï¼Œæ‹–ç´¯åŠå°é«”æ¬Šå€¼è‚¡ã€‚',
                'éŒ¯æ®ºæ€§è³ªï¼šå…ˆé€²è£½ç¨‹ç”¢èƒ½æ»¿è¼‰ï¼ŒåŸºæœ¬é¢æœªè®Šï¼Œç´”å±¬è³‡é‡‘é¢ææ¬¾ã€‚'
              ],
              recoveryDays: '15 ~ 20',
              volumeStatus: 'é‡ç¸®æ•´ç†',
              potentialUpside: 13, 
              strategy: 'å»ºè­°è§€æœ›ï¼Œå¾…ç«™å›äº”æ—¥ç·šå¾Œåˆ†æ‰¹ä½ˆå±€ã€‚'
            },
            similarHistory: [
              { event: '2022 ä¿„çƒæˆ°çˆ­çˆ†ç™¼', outcome: 'è‚¡åƒ¹æ€¥è·Œ 15% å¾Œï¼Œæ–¼ 2 å€‹æœˆå…§æ”¶å¾©å¤±åœŸä¸¦å‰µæ–°é«˜ã€‚' },
              { event: '2020 ç–«æƒ…ææ…Œ', outcome: 'V å‹åè½‰ï¼Œç¢ºèªç‚ºè©²å¹´åº¦æœ€ä½³è²·é»ã€‚' }
            ],
            newsLinks: [
              { title: 'å¤–è³‡è§€é»ï¼šåœ°ç·£é¢¨éšªä¸å½±éŸ¿ 2nm é ˜å…ˆåœ°ä½', source: 'è²¡ç¶“æ—¥å ±' },
              { title: 'å°ç©é›»æ³•èªªæœƒå‰ç»ï¼šå…ˆé€²è£½ç¨‹éœ€æ±‚å¼·å‹', source: 'ç§‘æŠ€æ–°å ±' },
              { title: 'å…¨çƒåŠå°é«”åº«å­˜å»åŒ–é †åˆ©ï¼ŒQ1 å¯æœ›è½åº•', source: 'æŠ•è³‡äººå‘¨åˆŠ' }
            ]
          },
          {
            id: '2454',
            name: 'è¯ç™¼ç§‘',
            price: 1410,
            low: 1400,
            change: -3.5,          
            volume: 4250,
            avgVolume5dVal: 55,    
            priceAvg20d: 1460,
            priceAvg60d: 1480,
            bollingerLower: 1420,  
            marketCapVal: 22700,
            rsi6: 25,              
            netBuy5d: 200,         
            institutionalHoldings: 65,
            eps4Q: 66.6,
            roe: 27.1,
            isExDividend: false,
            sector: 'ICè¨­è¨ˆ',
            panicLevel: 65,
            fairValue: 1650,
            resistancePrice: 1500,
            history: [
              { date: '01/06', price: 1480 }, { date: '01/07', price: 1460 }, { date: '01/08', price: 1450 },
              { date: '01/09', price: 1445 }, { date: '01/10', price: 1430 }, { date: '01/12', price: 1410 },
            ],
            aiDiagnosis: {
              probability: 85,
              natureTag: 'SHORT_TERM',
              conclusion: 'ç”¢å“åƒ…æ˜¯å»¶å¾Œå‡ºè²¨è€Œéè¨‚å–®æ¶ˆå¤±ï¼Œé›–ç„¶å¸‚å ´å› èª¤è§£è€Œæ‹‹å”®ï¼Œä½†å¤§æˆ¶è³‡é‡‘å·²é–‹å§‹é€¢ä½æ‰¿æ¥ã€‚',
              reasons: [
                'ç‡Ÿæ”¶éå»¶æ•ˆæ‡‰ï¼š5G æ——è‰¦æ™¶ç‰‡å‡ºè²¨éå»¶è‡³ 2æœˆï¼Œå°è‡´ 1æœˆç‡Ÿæ”¶æœˆæ¸› 12%ã€‚',
                'è¬ è¨€æ¾„æ¸…ï¼šå¸‚å ´å‚³èé™¸ç³»æ‰‹æ©Ÿç å–®ï¼Œå…¬å¸å·²ç™¼é‡è¨Šåš´æ­£å¦èªã€‚',
                'ç±Œç¢¼ç•°å¸¸ï¼šè‚¡åƒ¹ç ´åº•ä½†ä¸»åŠ›åˆ¸å•†ï¼ˆç¾æ—ã€æ‘©æ ¹ï¼‰é€†å‹¢è²·è¶… 800 å¼µã€‚'
              ],
              recoveryDays: '10 ~ 15',
              volumeStatus: 'çª’æ¯é‡',
              potentialUpside: 17, 
              strategy: 'Strong Buyã€‚å»ºè­°åˆ† 3 æ—¥é€²å ´ï¼Œé¦–ç­†è³‡é‡‘å¯æ–¼ä»Šæ—¥å°¾ç›¤æŠ•å…¥ã€‚'
            },
            similarHistory: [
              { event: '2021 ä¾›æ‡‰éˆç¼ºæ–™ç–‘æ…®', outcome: 'æ¾„æ¸…å¾Œè‚¡åƒ¹é€£ä¸‰ç´…ï¼Œå–®å‘¨åå½ˆ 8%ã€‚' }
            ],
            newsLinks: [
              { title: 'è¯ç™¼ç§‘å¤©ç’£ 9500 å¯¦æ¸¬æ•¸æ“šæ›å…‰ï¼Œæ•ˆèƒ½è¶…é æœŸ', source: '3C ç§‘æŠ€ç¶²' },
              { title: 'å¤§æ‘©é‡ç”³è¯ç™¼ç§‘ã€Œå„ªæ–¼å¤§ç›¤ã€è©•ç­‰ï¼Œç›®æ¨™åƒ¹ä¸è®Š', source: 'å¤–è³‡è§€æ¸¬ç«™' },
              { title: 'ä¸­åœ‹æ‰‹æ©Ÿå¸‚å ´å¾©ç”¦ï¼Œæ——è‰¦æ™¶ç‰‡éœ€æ±‚çœ‹å¢', source: 'ç”¢æ¥­å¿«è¨Š' }
            ]
          },
          {
            id: '3037',
            name: 'æ¬£èˆˆ',
            price: 175.0,
            low: 172.0,
            change: -4.5,          
            volume: 12000,
            avgVolume5dVal: 20,    
            priceAvg20d: 185.0,
            priceAvg60d: 195.0,
            bollingerLower: 178.0, 
            marketCapVal: 2700,
            rsi6: 18,              
            netBuy5d: -1500,       
            institutionalHoldings: 40,
            eps4Q: 8.5,
            roe: 15.2,
            isExDividend: false,
            sector: 'PCB',
            panicLevel: 85,
            fairValue: 220,
            resistancePrice: 190,
            history: [
              { date: '01/06', price: 195 }, { date: '01/07', price: 190 }, { date: '01/08', price: 188 },
              { date: '01/09', price: 185 }, { date: '01/10', price: 182 }, { date: '01/12', price: 175 },
            ],
            aiDiagnosis: {
              probability: 70,
              natureTag: 'EXTERNAL',
              conclusion: 'å—åˆ°åŒæ¥­è² é¢æ¶ˆæ¯æ‹–ç´¯ï¼Œå¼•ç™¼æŠ•è³‡äººææ…Œæ€§è³£å‡ºï¼Œå°è‡´ç›®å‰ç±Œç¢¼ç‹€æ…‹ä»è™•æ–¼ä¸ç©©å®šéšæ®µã€‚',
              reasons: [
                'å ±åƒ¹é¬†å‹•ç–‘æ…®ï¼šæ—¥å•† Ibiden è²¡å ±ç¤ºè­¦ ABF éœ€æ±‚æ”¾ç·©ï¼Œå¼•ç™¼æ—ç¾¤ä¿®æ­£ã€‚',
                'èè³‡æ–·é ­ï¼šèè³‡ç¶­æŒç‡è·Œç ´ 140% è­¦æˆ’ç·šï¼Œè§¸ç™¼æ•£æˆ¶å¤šæ®ºå¤šã€‚',
                'æŠ•ä¿¡åœæï¼šæŠ•ä¿¡å­£åº•çµå¸³è³£å£“æ¹§ç¾ï¼Œé€£çºŒ 5 æ—¥è³£è¶…åˆè¨ˆ 6,200 å¼µã€‚'
              ],
              recoveryDays: '20 ~ 25',
              volumeStatus: 'çˆ†é‡ä¸‹æ®º',
              potentialUpside: 25,
              strategy: 'æ€¥è·Œä¸æ¥åˆ€ã€‚å¾…æˆäº¤é‡ç¸®è‡³ 5000 å¼µä»¥ä¸‹å†è¡Œä»‹å…¥ã€‚'
            },
            similarHistory: [
              { event: '2023 åº«å­˜å»åŒ–ä¿®æ­£', outcome: 'è‚¡åƒ¹ç›¤æ•´ 3 å€‹æœˆå¾Œæ‰ç¯‰åº•å®Œæˆï¼Œå±¬Lå‹å¾©ç”¦ã€‚' }
            ],
            newsLinks: [
              { title: 'ABF è¼‰æ¿å ±åƒ¹é¬†å‹•ï¼Ÿæ¥­å…§äººå£«ï¼šåƒ…éƒ¨åˆ†ä½éšç”¢å“', source: 'é›»å­æ™‚å ±' },
              { title: 'æŠ•ä¿¡å­£åº•çµå¸³åå–®å‡ºåˆ—ï¼ŒPCB æ—ç¾¤é¦–ç•¶å…¶è¡', source: 'ç†è²¡ç¶²' },
              { title: 'Ibiden è²¡å ±ä¸å¦‚é æœŸï¼Œæ‹–ç´¯äºæ´²è¼‰æ¿è‚¡', source: 'åœ‹éš›è²¡ç¶“' }
            ]
          },
          {
            id: '8298',
            name: 'åœ°é›·KY',
            price: 32.0,
            change: -9.8,
            volume: 500,
            avgVolume5dVal: 0.08, 
            priceAvg20d: 40,
            priceAvg60d: 45,
            bollingerLower: 30,
            marketCapVal: 50,
            rsi6: 10,
            netBuy5d: -50,
            institutionalHoldings: 2,
            eps4Q: -2.5,          
            roe: -10,
            isExDividend: false,
            sector: 'ç”ŸæŠ€',
            panicLevel: 95,
            fairValue: 20,
            resistancePrice: 35,
            history: Array(6).fill({date: '01/12', price: 32}),
            aiDiagnosis: {
              probability: 10,
              natureTag: 'STRUCTURAL',
              conclusion: 'ç”±æ–¼å¸³ç›®å•é¡Œå°šå¾…é‡æ¸…ï¼Œå…¬å¸è²¡å‹™çµæ§‹å­˜åœ¨é«˜åº¦ä¸ç¢ºå®šæ€§ï¼Œé€™å±¬æ–¼ä¼æ¥­æœ¬è³ªä¸Šçš„é¢¨éšªã€‚',
              reasons: [
                'æœƒè¨ˆå¸«ä¿ç•™æ„è¦‹ï¼šç„¡æ³•é‡æ¸…æµ·å¤–å­å…¬å¸ 5 å„„å…ƒå¸³æ¬¾æµå‘ï¼Œè²¡å ±å¡é—œã€‚',
                'å¤§è‚¡æ±æ‹‹å”®ï¼šè‘£äº‹é•·é…å¶ç”³å ±è½‰è®“æŒè‚¡ 2,000 å¼µï¼Œå¼•ç™¼æç©ºç–‘æ…®ã€‚',
                'æ ¸å¿ƒæ¥­å‹™æµå¤±ï¼šä¸»è¦æ­ç¾å®¢æˆ¶çµ‚æ­¢åˆç´„ï¼Œç‡Ÿæ”¶é¢è‡¨è…°æ–¬é¢¨éšªã€‚'
              ],
              recoveryDays: 'N/A',
              volumeStatus: 'ç„¡é‡è·Œåœ',
              potentialUpside: 0,
              strategy: 'è³£å‡ºã€‚ä¸æ¶åå½ˆã€‚'
            },
            similarHistory: [
              { event: '2020 åº·å‹-KY äº‹ä»¶', outcome: 'è²¡å ±é€ å‡çˆ†ç™¼å¾Œé€£çºŒè·Œåœï¼Œæœ€çµ‚ä¸‹å¸‚ã€‚' }
            ],
            newsLinks: [
              { title: 'åœ°é›·KY é‡è¨Šè¨˜è€…æœƒï¼šç„¡æ³•è§£é‡‹è³‡é‡‘æµå‘', source: 'è­‰äº¤æ‰€' },
              { title: 'é‡‘ç®¡æœƒä»‹å…¥èª¿æŸ¥ï¼Œåœ°é›·KY æé¢è‡¨æš«åœäº¤æ˜“', source: 'æ–°èé ­æ¢' },
              { title: 'å°è‚¡æ±è‡ªæ•‘æœƒæˆç«‹ï¼Œæ“¬å°ç¶“ç‡Ÿå±¤æå‘Š', source: 'ç¤¾æœƒæ–°è' }
            ]
          }
        ];

        // --- Logic Core ---

        function analyzeStock(stock) {
          const analysis = {
            checks: [],
            triggerTypes: [], 
            isPassed: false,
            failReason: null,
            opportunityScore: 0,
            deviation: 0,
            betaCheck: true,
          };

          const isLiquid = stock.avgVolume5dVal >= 0.1;
          const isProfitable = stock.eps4Q > 0;
          const isCleanEvent = !stock.isExDividend;
          
          const passSurvival = isLiquid && isProfitable && isCleanEvent;
          
          analysis.checks.push({ name: 'æµå‹•æ€§ > 1000è¬', pass: isLiquid, value: `${(stock.avgVolume5dVal * 100).toFixed(0)}00è¬` });
          analysis.checks.push({ name: 'ç²åˆ©å®‰å…¨ (EPS > 0)', pass: isProfitable, value: stock.eps4Q });
          
          if (!passSurvival) {
            analysis.failReason = !isLiquid ? "æµå‹•æ€§ä¸è¶³" : (!isProfitable ? "è™§æå…¬å¸" : "é™¤æ¬Šæ¯é›œè¨Š");
            return analysis;
          }

          const isRsiOversold = stock.rsi6 < 20;
          const isBollingerBreak = stock.price < stock.bollingerLower;

          if (isRsiOversold) analysis.triggerTypes.push('RSI_OVERSOLD');
          if (isBollingerBreak) analysis.triggerTypes.push('BB_BREAK');

          if (analysis.triggerTypes.length === 0) {
            analysis.failReason = "æœªé”è¶…è³£è§¸ç™¼æ¢ä»¶";
          }

          let passBeta = true;
          if (MARKET_DROP_TODAY < 0) {
             const threshold = MARKET_DROP_TODAY * 1.5; 
             if (stock.change > threshold) {
                passBeta = false;
                analysis.failReason = `Betaæ ¡æ­£å¤±æ•— (è·Œå¹…æœªé”å¤§ç›¤1.5å€)`;
             }
          }
          analysis.betaCheck = passBeta;

          analysis.isPassed = passSurvival && analysis.triggerTypes.length > 0 && passBeta;

          if (analysis.isPassed) {
              const probScore = stock.aiDiagnosis.probability;
              
              analysis.deviation = ((stock.price - stock.priceAvg60d) / stock.priceAvg60d) * 100;
              const deviationScore = Math.min(Math.abs(analysis.deviation) * 3.5, 100);
              
              let chipScore = 0;
              if (stock.netBuy5d > 0) chipScore = 100;       
              else if (stock.institutionalHoldings > 50) chipScore = 50; 
              else chipScore = 0;

              analysis.opportunityScore = Math.round(
                  (probScore * 0.5) + (deviationScore * 0.3) + (chipScore * 0.2)
              );
          }

          return analysis;
        }

        // --- Components ---

        function NatureBadge({ tag }) {
          switch(tag) {
            case 'SHORT_TERM': 
              return <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full font-bold text-xs border border-green-200 inline-flex items-center gap-1">ğŸŸ¢ çŸ­æœŸæ„å¤–</span>;
            case 'EXTERNAL': 
              return <span className="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-bold text-xs border border-yellow-200 inline-flex items-center gap-1">ğŸŸ¡ å¤–éƒ¨ç’°å¢ƒ</span>;
            case 'STRUCTURAL': 
              return <span className="px-3 py-1 bg-red-100 text-red-800 rounded-full font-bold text-xs border border-red-200 inline-flex items-center gap-1">ğŸ”´ çµæ§‹æå£</span>;
            default: return null;
          }
        }

        function StockCard({ stock, analysis, onClick }) {
          const isPassed = analysis.isPassed;
          
          return (
            <div 
              onClick={() => onClick(stock)}
              className={`relative bg-white p-4 rounded-xl shadow-sm border transition-all cursor-pointer hover:shadow-md group ${!isPassed ? 'opacity-60 grayscale-[0.5] border-slate-200' : 'border-slate-100 hover:border-indigo-200'}`}
            >
              {!isPassed && (
                <div className="absolute top-2 right-2 px-2 py-0.5 bg-slate-100 text-slate-500 text-xs font-bold rounded flex items-center gap-1">
                  <XCircle size={12} /> {analysis.failReason || "æœªå…¥é¸"}
                </div>
              )}

              <div className="flex justify-between items-start mb-2">
                <div className="flex items-center gap-3">
                  <div className={`w-12 h-12 rounded-lg flex items-center justify-center font-bold text-white text-sm ${isPassed ? 'bg-indigo-600' : 'bg-slate-400'}`}>
                    {stock.id}
                  </div>
                  <div>
                    <h3 className="font-bold text-slate-800 text-lg leading-tight group-hover:text-indigo-600 transition-colors">{stock.name}</h3>
                  </div>
                </div>
                
                <div className="text-right">
                  <div className="font-mono text-xl font-bold text-slate-900">{stock.price}</div>
                  <div className={`font-mono text-sm font-bold ${stock.change < 0 ? 'text-green-600' : 'text-red-600'}`}>
                    {stock.change}%
                  </div>
                </div>
              </div>

              {/* Conclusion Comment */}
              {isPassed && (
                <div className="mt-2 mb-3 p-3 bg-slate-50 rounded-lg border border-slate-100">
                   <div className="mb-2">
                      <NatureBadge tag={stock.aiDiagnosis.natureTag} />
                   </div>
                   <div className="flex items-start gap-2">
                      <Lightbulb size={14} className="text-indigo-500 mt-0.5 shrink-0" />
                      <span className="text-sm text-slate-700 font-medium leading-tight">
                        {stock.aiDiagnosis.conclusion}
                      </span>
                   </div>
                </div>
              )}
              
              <div className="flex items-center justify-between pt-2 border-t border-slate-50 mt-2">
                {isPassed ? (
                  <>
                     <div className="flex items-center gap-1.5">
                       <span className="text-xs text-slate-400">é ä¼°ä¿®å¾©</span>
                       <span className="font-bold text-slate-700">{stock.aiDiagnosis.recoveryDays}å¤©</span>
                     </div>

                     <div className="flex items-center gap-1.5">
                       <span className="text-xs text-slate-400">æ½›åœ¨ç©ºé–“</span>
                       <span className="font-bold text-green-600">+{stock.aiDiagnosis.potentialUpside}%</span>
                     </div>

                     <div className="flex items-center gap-1">
                        <Gauge size={14} className={analysis.opportunityScore >= 80 ? 'text-red-600' : 'text-orange-500'} />
                        <span className={`font-bold font-mono text-base ${analysis.opportunityScore >= 80 ? 'text-red-600' : 'text-orange-500'}`}>
                            {analysis.opportunityScore}
                        </span>
                     </div>
                  </>
                ) : (
                   <div className="text-xs text-slate-400 pt-1">
                      ç­‰å¾…è§¸ç™¼ä¿¡è™Ÿ...
                   </div>
                )}
              </div>
            </div>
          );
        }

        function DetailView({ stock, analysis, onBack }) {
          const { aiDiagnosis } = stock;
          
          const calculateResistancePercent = () => {
            const totalRange = stock.fairValue - stock.price;
            const resistanceOffset = stock.resistancePrice - stock.price;
            
            if (totalRange <= 0) return 0;
            
            let percent = (resistanceOffset / totalRange) * 100;
            return Math.max(10, Math.min(90, percent));
          };
          
          const resistancePercent = calculateResistancePercent();

          return (
            <div className="animate-in slide-in-from-right duration-300 pb-20">
              <div className="flex items-center gap-2 mb-6 text-slate-500 cursor-pointer hover:text-slate-800" onClick={onBack}>
                <ArrowLeft size={20} />
                <span>è¿”å›æ¸…å–®</span>
              </div>

              <div className="flex justify-between items-start mb-6">
                <div>
                  <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-2">
                    {stock.name} <span className="text-xl text-slate-400 font-medium">{stock.id}</span>
                  </h1>
                  <p className="text-slate-500 text-sm mt-1">{stock.sector} | å¸‚å€¼ {stock.marketCapVal} å„„</p>
                </div>
                <div className="text-right">
                  <div className="text-4xl font-bold font-mono tracking-tighter">{stock.price}</div>
                  <div className="text-green-600 font-bold font-mono text-xl">{stock.change}% â–¼</div>
                </div>
              </div>

              <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6">
                 <div className="bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center">
                    <div className="flex items-center gap-3">
                       <NatureBadge tag={aiDiagnosis.natureTag} />
                       <h2 className="font-bold text-slate-800">{aiDiagnosis.conclusion}</h2>
                    </div>
                    <div className="text-xs text-slate-400 font-mono">AI Model v4.0</div>
                 </div>

                 <div className="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    
                    <div className="space-y-4">
                       <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                          <Microscope size={16} /> æ ¸å¿ƒåŸå› è¨ºæ–·
                       </h3>
                       <ul className="space-y-2">
                          {aiDiagnosis.reasons.map((r, i) => (
                             <li key={i} className="flex gap-2 text-sm text-slate-700">
                                <span className="text-indigo-500 font-bold">â€¢</span>
                                {r}
                             </li>
                          ))}
                       </ul>
                    </div>

                    <div className="space-y-4">
                       <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                          <Calendar size={16} /> ä¿®å¾©æ™‚é–“é ä¼°
                       </h3>
                       <div className="bg-slate-50 p-3 rounded-lg border border-slate-100 text-center">
                          <div className="text-2xl font-bold text-slate-800">{aiDiagnosis.recoveryDays} <span className="text-sm font-normal text-slate-500">äº¤æ˜“æ—¥</span></div>
                       </div>
                    </div>

                    <div className="space-y-4 relative group/tooltip-container">
                       <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                          <Target size={16} /> æ½›åœ¨ç²åˆ©ç©ºé–“
                       </h3>
                       <div>
                          <div className="mb-4">
                             <span className="text-4xl font-black text-green-600 tracking-tighter">+{aiDiagnosis.potentialUpside}%</span>
                             <span className="text-xs text-slate-400 ml-2 font-medium uppercase tracking-wide">Upside Potential</span>
                          </div>
                          
                          <div className="relative pt-6 pb-2"> 
                             <div className="w-full h-3 bg-slate-100 rounded-full relative overflow-hidden">
                                <div className="absolute left-0 top-0 h-full w-full bg-gradient-to-r from-green-400 to-green-600 opacity-30"></div>
                             </div>

                             <div className="absolute left-0 top-4 pt-3 flex flex-col items-start">
                                <div className="h-3 w-0.5 bg-slate-400 mb-1 mx-1"></div> 
                                <span className="text-[10px] text-slate-400 font-bold uppercase">ç¾åƒ¹</span>
                                <span className="text-xs font-bold text-slate-800">${stock.price}</span>
                             </div>

                             <div className="absolute right-0 top-4 pt-3 flex flex-col items-end">
                                <div className="h-3 w-0.5 bg-green-500 mb-1 mx-1"></div> 
                                <span className="text-[10px] text-green-600 font-bold uppercase">ç›®æ¨™åƒ¹</span>
                                <span className="text-xs font-bold text-slate-800">${stock.fairValue}</span>
                             </div>

                             <div 
                                className="absolute top-0 h-full flex flex-col items-center group/marker z-10"
                                style={{ left: `${resistancePercent}%`, transform: 'translateX(-50%)' }}
                             >
                                <div className="mb-1 flex items-center gap-1 cursor-help relative">
                                    <span className="text-[10px] font-bold text-red-500 bg-red-50 px-1.5 py-0.5 rounded border border-red-100 whitespace-nowrap">
                                        å£“åŠ›ä½ ${stock.resistancePrice}
                                    </span>
                                    <HelpCircle size={12} className="text-red-400 hover:text-red-600 transition-colors" />

                                    {/* Tooltip Content */}
                                    <div className="tooltip-content opacity-0 absolute bottom-full mb-2 w-64 p-3 bg-slate-800 text-white text-xs rounded-lg shadow-xl pointer-events-none z-50 text-left">
                                        <div className="flex items-center gap-1 font-bold text-yellow-400 mb-1">
                                            <AlertTriangle size={12} />
                                            æ¸›é€Ÿå¸¶è­¦ç¤º
                                        </div>
                                        <p className="leading-relaxed text-slate-200">
                                            å£“åŠ›ä½å°±åƒæ˜¯æ¼²å‹¢çš„ã€Œæ¸›é€Ÿå¸¶ã€ï¼Œè‚¡åƒ¹åˆ°äº†é€™è£¡å®¹æ˜“æ’åˆ°å¤©èŠ±æ¿è€Œå›æª”ã€‚å¦‚æœä½ è¿½æ±‚ç©©å¥ã€ä¸æƒ³å†’é¢¨éšªï¼Œå»ºè­°åœ¨æ¥è¿‘å£“åŠ›ä½æ™‚å…ˆè³£å‡ºä¸‹è»Šï¼Œç¢ºä¿ç²åˆ©å…¥è¢‹ç‚ºå®‰ã€‚
                                        </p>
                                        <div className="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-800"></div>
                                    </div>
                                </div>

                                <div className="w-0.5 h-full bg-red-400 dashed relative">
                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full border-2 border-white shadow-sm"></div>
                                </div>
                             </div>
                          </div>
                       </div>
                    </div>
                 </div>

                 <div className="bg-indigo-50/50 p-4 border-t border-slate-100 flex items-start gap-3">
                    <Lightbulb size={20} className="text-indigo-500 mt-0.5" />
                    <div>
                       <div className="font-bold text-indigo-900 text-sm mb-0.5">æ“ä½œç­–ç•¥å»ºè­°</div>
                       <p className="text-sm text-indigo-800">{aiDiagnosis.strategy}</p>
                    </div>
                 </div>
              </div>

              <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-5 mb-6">
                 <div className="flex flex-col gap-2 mb-4">
                    <div className="flex justify-between items-center">
                        <h3 className="font-bold text-slate-800 flex items-center gap-2">
                          <Activity size={18} />
                          è‚¡åƒ¹èˆ‡å®šéŒ¨é» (æœˆç·š/å­£ç·š)
                        </h3>
                    </div>
                    
                    <div className="text-xs text-slate-400 mt-1 px-1">
                        <p>ç•¶è—è‰²å¯¦ç·šï¼ˆç¾åƒ¹ï¼‰é ä½æ–¼è™›ç·šæ™‚ï¼Œä¸­é–“çš„ç©ºéš™å³ç‚ºæ½›åœ¨çš„åå½ˆç©ºé–“ã€‚</p>
                    </div>
                 </div>
                 <div className="h-64 w-full">
                   <ResponsiveContainer width="100%" height="100%">
                     <AreaChart data={stock.history}>
                       <defs>
                         <linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1">
                           <stop offset="5%" stopColor="#4f46e5" stopOpacity={0.1}/>
                           <stop offset="95%" stopColor="#4f46e5" stopOpacity={0}/>
                         </linearGradient>
                       </defs>
                       <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                       <XAxis dataKey="date" axisLine={false} tickLine={false} tick={{fontSize: 12, fill: '#94a3b8'}} />
                       <YAxis domain={['auto', 'auto']} axisLine={false} tickLine={false} tick={{fontSize: 12, fill: '#94a3b8'}} />
                       <Tooltip />
                       <ReferenceLine y={stock.priceAvg20d} label={{ value: "æœˆç·š (20MA)", fill: '#3b82f6', fontSize: 11, position: 'insideTopRight' }} stroke="#3b82f6" strokeDasharray="3 3" />
                       <ReferenceLine y={stock.priceAvg60d} label={{ value: "å­£ç·š (60MA)", fill: '#ef4444', fontSize: 11, position: 'insideTopRight' }} stroke="#ef4444" strokeDasharray="3 3" />
                       <Area type="monotone" dataKey="price" stroke="#4f46e5" fillOpacity={1} fill="url(#colorPrice)" strokeWidth={2} />
                     </AreaChart>
                   </ResponsiveContainer>
                 </div>
              </div>

              {/* History Section */}
              {stock.similarHistory && (
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6">
                    <div className="bg-slate-50 p-4 border-b border-slate-100">
                        <h3 className="text-sm font-bold text-slate-800 flex items-center gap-2">
                            <History size={18} />
                            æ­·å²å€Ÿé¡ï¼šç›¸ä¼¼äº‹ä»¶å›é¡§
                        </h3>
                    </div>
                    <div className="p-4">
                        <div className="space-y-3">
                            {stock.similarHistory.map((item, idx) => (
                                <div key={idx} className="flex gap-3 items-start p-2 hover:bg-slate-50 rounded transition-colors">
                                    <div className="w-1.5 h-1.5 rounded-full bg-slate-300 mt-2 shrink-0"></div>
                                    <div>
                                        <div className="font-bold text-sm text-slate-700">{item.event}</div>
                                        <div className="text-xs text-slate-500 mt-0.5">{item.outcome}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
              )}

              {/* External News Section */}
              {stock.newsLinks && (
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="bg-slate-50 p-4 border-b border-slate-100">
                        <h3 className="text-sm font-bold text-slate-800 flex items-center gap-2">
                            <Activity size={18} />
                            å¸‚å ´ç„¦é»ï¼šç›¸é—œæ–°è
                        </h3>
                    </div>
                    <div className="divide-y divide-slate-100">
                        {stock.newsLinks.map((link, idx) => (
                            <a href={link.url} key={idx} className="block p-4 hover:bg-slate-50 transition-colors group">
                                <div className="flex justify-between items-start gap-4">
                                    <div>
                                        <div className="text-sm font-medium text-slate-800 group-hover:text-indigo-600 transition-colors line-clamp-1">
                                            {link.title}
                                        </div>
                                        <div className="text-xs text-slate-400 mt-1 flex items-center gap-1">
                                            <span>{link.source}</span>
                                        </div>
                                    </div>
                                    <ExternalLink size={14} className="text-slate-300 group-hover:text-indigo-400 shrink-0 mt-1" />
                                </div>
                            </a>
                        ))}
                    </div>
                </div>
              )}
              
            </div>
          );
        }

        function App() {
          const [stocks, setStocks] = useState(INITIAL_STOCKS);
          const [selectedStock, setSelectedStock] = useState(null);
          const [strictMode, setStrictMode] = useState(true);
          const [searchQuery, setSearchQuery] = useState('');

          const processedStocks = useMemo(() => {
            return stocks.map(stock => {
              const analysis = analyzeStock(stock);
              return { ...stock, analysis };
            }).sort((a, b) => b.analysis.opportunityScore - a.analysis.opportunityScore); 
          }, [stocks]);

          const filteredStocks = processedStocks.filter(stock => {
            const matchesSearch = stock.name.includes(searchQuery) || stock.id.includes(searchQuery);
            return matchesSearch && stock.analysis.triggerTypes.length > 0;
          });

          return (
            <div className="min-h-screen bg-slate-50 text-slate-900 font-sans pb-20">
              
              <nav className="bg-white border-b border-slate-200 sticky top-0 z-10 px-4 py-3 shadow-sm">
                <div className="max-w-5xl mx-auto flex justify-between items-center">
                  <div className="flex items-center gap-2">
                     <div className="bg-rose-500 text-white p-2 rounded-lg shadow-lg shadow-rose-200">
                        <Activity size={20} strokeWidth={3} />
                     </div>
                     <div>
                       <span className="font-bold text-xl tracking-tight block leading-none">Rebounder</span>
                       <span className="text-xs text-slate-400 font-mono">v4.0 AI Diagnosis</span>
                     </div>
                  </div>
                </div>
              </nav>

              <main className="max-w-5xl mx-auto px-4 py-6">
                
                {selectedStock ? (
                  <DetailView stock={selectedStock} analysis={selectedStock.analysis} onBack={() => setSelectedStock(null)} />
                ) : (
                  <div className="animate-in fade-in duration-300">
                    <div className="mb-8">
                      <h1 className="text-2xl font-bold text-slate-900 mb-2">é€†è½‰è‚¡ç¥¨</h1>
                    </div>

                    <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6 flex flex-col md:flex-row gap-4 items-center justify-between">
                      <div className="relative w-full">
                        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" size={18} />
                        <input 
                          type="text" 
                          placeholder="æœå°‹ä»£è™Ÿæˆ–åç¨±..." 
                          className="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          value={searchQuery}
                          onChange={(e) => setSearchQuery(e.target.value)}
                        />
                      </div>
                    </div>

                    <div className="space-y-4">
                      <div className="flex justify-between items-center px-2">
                        <h2 className="text-sm font-bold text-slate-400 uppercase tracking-wider">
                          AI è¨ºæ–·å€™é¸ ({filteredStocks.length})
                        </h2>
                        <div className="flex items-center gap-2 text-xs text-slate-400">
                           <span>æ’åºï¼šæ©ŸæœƒæŒ‡æ•¸ Score</span>
                        </div>
                      </div>

                      {filteredStocks.length > 0 ? (
                        filteredStocks.map(stock => (
                          <StockCard 
                            key={stock.id} 
                            stock={stock} 
                            analysis={stock.analysis}
                            onClick={setSelectedStock} 
                          />
                        ))
                      ) : (
                        <div className="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
                          <div className="bg-slate-50 p-4 rounded-full inline-block mb-3">
                            <CheckCircle size={32} className="text-green-500" />
                          </div>
                          <p className="text-slate-900 font-bold text-lg">ç›®å‰å¸‚å ´ç„¡è¶…è·Œæ¨™çš„</p>
                          <p className="text-slate-500 mt-1">æœªåµæ¸¬åˆ°ç¬¦åˆ RSI &lt; 20 æˆ– ç ´å¸ƒæ—ä¸‹è»Œ ä¹‹é«˜æµå‹•æ€§ç²åˆ©è‚¡ã€‚</p>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </main>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
